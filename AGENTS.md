# LocalTopSH Agent Evolution

## Ğ§Ñ‚Ğ¾ ÑÑ‚Ğ¾
Telegram Ğ±Ğ¾Ñ‚ Ñ ReAct Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ¼, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ´Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼Ñƒ Linux Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ.
ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ 1500+ Ñ…Ğ°ĞºĞµÑ€Ğ°Ğ¼Ğ¸ Ğ² Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ @neuraldeepchat Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 7 Ñ‡Ğ°ÑĞ¾Ğ².
Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: 0 ÑƒÑ‚ĞµÑ‡ĞµĞº ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ², 0 Ğ´Ğ°ÑƒĞ½Ñ‚Ğ°Ğ¹Ğ¼Ğ°.

## Security Model â€” The Pentagram ğŸ”®

```
                           â›§ THE SECURITY PENTAGRAM â›§
                        
                                 ğŸ” ACCESS
                                    â•±â•²
                                   â•±  â•²
                                  â•±    â•²
                                 â•±  â›§   â•²
                                â•±        â•²
                               â•±    ğŸ‘ï¸    â•²
                              â•±   AGENT    â•²
                      ğŸ›¡ï¸ INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ OUTPUT ğŸ”’
                            â•²      â•±â•²      â•±
                             â•²    â•±  â•²    â•±
                              â•²  â•±    â•²  â•±
                               â•²â•±  â›§   â•²â•±
                               â•±â•²      â•±â•²
                              â•±  â•²    â•±  â•²
                             â•±    â•²  â•±    â•²
                            â•±      â•²â•±      â•²
                     ğŸ³ SANDBOX â”€â”€â”€â”€â”€â”€â”€â”€ SECRETS ğŸ—ï¸
                        
           "Per aspera ad securitatem" â€” Through hardship to security
```

### The Five Points of Protection

| Point | Guardian | Power | Patterns |
|-------|----------|-------|----------|
| ğŸ” **ACCESS** | DM Policy | Who enters the circle | pairing/allowlist |
| ğŸ›¡ï¸ **INPUT** | Validators | What darkness they bring | 247 + 19 patterns |
| ğŸ³ **SANDBOX** | Docker | Contain the chaos | 512MB, 50% CPU |
| ğŸ—ï¸ **SECRETS** | Proxy | Keys remain hidden | 0 secrets in agent |
| ğŸ”’ **OUTPUT** | Sanitizer | Nothing escapes unseen | base64/hex detect |

## Ğ¦Ğ¸ĞºĞ» ÑĞ²Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸ â€” The Eternal Vigil ğŸ•¯ï¸

```
              â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
              â”‚         â‘  ğŸ‘ï¸ OBSERVE               â”‚
              â”‚    "Watch the shadows move"        â”‚
              â”‚    docker logs -f | grep SECURITY  â”‚
              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                             â”‚
         â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
         â”‚                   â”‚                   â”‚
         â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚[BLOCKED]â”‚        â”‚[INJECT] â”‚        â”‚ [DENY]  â”‚
    â”‚ Command â”‚        â”‚ Prompt  â”‚        â”‚  Tool   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                   â”‚                   â”‚
         â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                             â”‚
              â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
              â”‚         â‘¡ ğŸ”® DIVINE                â”‚
              â”‚    "Understand the attack"         â”‚
              â”‚    Analyze pattern, find weakness  â”‚
              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                             â”‚
              â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
              â”‚         â‘¢ âš”ï¸ FORTIFY               â”‚
              â”‚    "Strengthen the seals"          â”‚
              â”‚    Add pattern to blocked-*.json   â”‚
              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                             â”‚
              â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
              â”‚         â‘£ ğŸ”¥ REBIRTH               â”‚
              â”‚    "Rise anew, stronger"           â”‚
              â”‚    docker compose up -d --build    â”‚
              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                             â”‚
              â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
              â”‚         â‘¤ â›§ VERIFY                 â”‚
              â”‚    "The Pentagram must hold"       â”‚
              â”‚    python scripts/doctor.py        â”‚
              â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
                             â”‚
                             â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â‘  (eternal loop)
```

## ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ°Ñ‚Ñ‡Ğ¸Ğ½Ğ³Ğ°

| Ğ¤Ğ°Ğ¹Ğ» | Ğ§Ñ‚Ğ¾ Ğ¿Ğ°Ñ‚Ñ‡Ğ¸Ñ‚ÑŒ |
|------|-------------|
| `core/src/approvals/blocked-patterns.json` | 247 security patterns |
| `bot/prompt-injection-patterns.json` | 19 injection patterns |
| `core/tools/permissions.py` | Tool allowlist/denylist |
| `bot/access.py` | DM Policy (pairing/allowlist) |
| `core/src/agent/system.txt` | Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ |
| `scripts/doctor.py` | Security audit CLI |

## Access Control Commands

```bash
# Show access status (admin only)
/access

# Change mode
/access_mode admin      # Only admin
/access_mode allowlist  # Admin + allowed users
/access_mode pairing    # OpenClaw-style pairing codes
/access_mode public     # Anyone (âš ï¸ risky)

# Approve pairing code
/approve ABC123

# Revoke user
/revoke 123456789

# Add to allowlist
/allow 123456789
```

## Security Audit

```bash
# Run security doctor
python scripts/doctor.py

# Output as JSON
python scripts/doctor.py --json

# Checks performed:
# - Secrets configuration
# - Docker compose security
# - Blocked patterns (247)
# - Injection patterns (19)
# - Network exposure
# - File permissions
# - Access mode
# - Resource limits
```

## Tool Permissions by Session Type

| Session | Available Tools | Denied Tools |
|---------|----------------|--------------|
| **Main (DM)** | All 17 | - |
| **Group** | 14 | send_dm, manage_message, schedule_task |
| **Sandbox** | 10 | telegram tools, scheduler |
| **Userbot** | 13 | send_file, send_dm, manage_message, ask_user |

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Gateway   â”‚â”€â”€â”€â”€â–¶â”‚    Proxy    â”‚â”€â”€â”€â”€â–¶â”‚  External   â”‚
â”‚  (Bot+Agent)â”‚     â”‚ (API Keys)  â”‚     â”‚    APIs     â”‚
â”‚  0 secrets  â”‚     â”‚  /run/sec/  â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /workspace â”‚
â”‚  per-user   â”‚
â”‚  isolated   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

```bash
# Security audit
python scripts/doctor.py

# Ğ›Ğ¾Ğ³Ğ¸ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
docker logs gateway -f --tail 100

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ Ğ¶Ğ¸Ğ²Ñ‹
docker ps

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ°Ñ‚Ñ‡Ğ°
docker compose down && docker compose up -d --build

# ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ‡Ğ°Ñ‚Ğ°
cat workspace/_shared/CHAT_HISTORY.md | tail -100

# ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ pairing ĞºĞ¾Ğ´Ñ‹ (admin)
cat workspace/_shared/pairing.json
```

## ĞŸÑ€Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ°

1. `docker ps` - Ğ²ÑĞµ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Up
2. `docker logs gateway` - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
3. `python scripts/doctor.py` - security audit
4. Ğ•ÑĞ»Ğ¸ OOM - ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ memory limit Ğ² docker-compose.yml
5. Ğ•ÑĞ»Ğ¸ rate limit - ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹ Ğ² `src/config.ts`

## Centralized Config

Ğ’ÑĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ² `src/config.ts`:
- Rate limits, timeouts, agent behavior
- Reactions, thoughts, messages
- Storage limits (chat history, memory)
- Admin ID, valid emojis

## Comparison with OpenClaw

| Feature | LocalTopSH | OpenClaw |
|---------|------------|----------|
| DM Policy | âœ… admin/allowlist/public/pairing | âœ… pairing/allowlist/open |
| Sandbox | âœ… Docker per-user | âœ… Docker per-session |
| Blocked Patterns | 247 | ~200 |
| Prompt Injection | 19 patterns | ~20 patterns |
| Tool Permissions | âœ… by session type | âœ… similar |
| Security Audit CLI | âœ… `python scripts/doctor.py` | âœ… `openclaw doctor` |
| Multi-channel | Telegram only | 12+ channels |
| Admin Panel | âœ… React :3000 | âœ… Control UI |
